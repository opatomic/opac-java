#!/bin/sh


# note: must have jdk installed to build!

TMPDIR="tmp"
OUTDIR="out"
DOCSDIR="../docs"


deldir() {
	if [ -d "$1" ]; then
		rm -r "$1"
	fi
}

cleandir() {
	deldir "$1"
	mkdir "$1"
}


VERSION="$(./verget)"

cleandir "$OUTDIR"
cleandir "$TMPDIR"
cleandir "$DOCSDIR"

# TODO: look into compiling for older versions of java
#javac -target 1.5 -source 1.5 -d "$TMPDIR" ../src/com/opatomic/*.java
javac -d "$TMPDIR" ../src/com/opatomic/*.java
# TODO: add license file to jar?
echo "opac-version: $VERSION" >> "$TMPDIR/build.txt"
#TODO: add more info to build.txt - date/time, machine info?
jar cvf "$OUTDIR/opac.jar" -C "$TMPDIR" .
deldir "$TMPDIR"


javadoc -quiet -notimestamp --no-module-directories -header "opac-$VERSION" -d "$DOCSDIR" -sourcepath ../src com.opatomic


## This will build the YCSB source; must set correct path to lib folder
#cleandir $TMPDIR
#javac -d $TMPDIR -cp "$HOME/Downloads/ycsb-redis-binding-0.15.0/lib/*:$OUTDIR/opac.jar" ../test/com/yahoo/ycsb/db/*.java
#jar cvf $OUTDIR/opatomic-ycsb.jar -C $TMPDIR .
#deldir $TMPDIR

